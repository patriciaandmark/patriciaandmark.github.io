
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patricia & Mark | 06.08.26</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;600&family=Libre+Baskerville:wght@400;700&family=Lancelot&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Lancelot', cursive;
      background: #f9f9f9;
      color: #333;
      margin: 0;
      text-align: center;
    }
    nav {
      background: #fff;
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    nav a {
      margin: 0 1rem;
      text-decoration: none;
      color: #7e6d65;
      font-weight: 600;
      font-family: 'Libre Baskerville', serif;
      letter-spacing: 0.5px;
    }
    nav a:hover {
      color: #c9bab0;
      transition: color 0.3s ease;
    }
    #page-content {
      padding: 2rem;
      opacity: 0;
      transition: opacity 0.5s ease;
      font-family: 'Libre Baskerville', serif;
    }
    #page-content.loaded {
      opacity: 1;
    }
  </style>
</head>
<body>
  <nav>
    <a href="#" onclick="return navigateTo('welcome');">Welcome</a>
    <a href="#" onclick="return navigateTo('our-story');">Our Story</a>
    <a href="#" onclick="return navigateTo('gallery');">Gallery</a>
    <a href="#" onclick="return navigateTo('rsvp');">RSVP</a>
    <a href="#" onclick="return navigateTo('faq');">FAQs</a>
  </nav>

  <main id="page-content"></main>

  <footer>Made with love by Patricia & Mark</footer>

  <script>
    const ROUTES = {
      'welcome':   { file: 'welcome.html', token: 'c11' },
      'our-story': { file: 'our-story.html', token: 'a24' },
      'gallery':   { file: 'gallery.html', token: 'f35' },
      'rsvp':      { file: 'rsvp.html', token: 'k48' },
      'faq':       { file: 'faq.html', token: 'q59' }
    };

    const DEFAULT_ROUTE = 'welcome';
    let currentRouteKey = null;

    function getRoute(identifier) {
      if (identifier === null || identifier === undefined) return null;
      const raw = String(identifier).trim().toLowerCase();
      if (!raw) return null;

      if (Object.prototype.hasOwnProperty.call(ROUTES, raw)) {
        const match = ROUTES[raw];
        return { key: raw, file: match.file, token: match.token };
      }

      const normalizedFile = raw.endsWith('.html') ? raw : `${raw}.html`;
      for (const [key, value] of Object.entries(ROUTES)) {
        if (value.token.toLowerCase() === raw) {
          return { key, file: value.file, token: value.token };
        }
        if (value.file.toLowerCase() === normalizedFile) {
          return { key, file: value.file, token: value.token };
        }
        const fileWithoutExt = value.file.replace(/\.html$/i, '').toLowerCase();
        if (fileWithoutExt === raw) {
          return { key, file: value.file, token: value.token };
        }
      }

      return null;
    }

    function executeEmbeddedScripts(container) {
      const scripts = container.querySelectorAll('script');
      scripts.forEach((script) => {
        const newScript = document.createElement('script');
        if (script.src) {
          newScript.src = script.src;
          newScript.defer = script.defer;
          newScript.async = script.async;
        } else {
          newScript.textContent = script.textContent;
        }
        document.body.appendChild(newScript);
        script.remove();
        if (!newScript.src) {
          newScript.remove();
        } else {
          const cleanup = () => newScript.remove();
          newScript.addEventListener('load', cleanup, { once: true });
          newScript.addEventListener('error', cleanup, { once: true });
        }
      });
    }

    function updateHistory(route, replace) {
      const url = new URL(window.location);
      const params = new URLSearchParams(url.search);
      params.delete('page');
      params.set('v', route.token);
      const query = params.toString();
      const targetUrl = query ? `${url.pathname}?${query}` : url.pathname;
      const method = replace ? 'replaceState' : 'pushState';
      window.history[method]({ route: route.key }, '', targetUrl);
    }

    function renderRoute(input, options = {}) {
      const routeInfo = typeof input === 'string' ? getRoute(input) : input;
      const route = routeInfo || getRoute(DEFAULT_ROUTE);
      if (!route) return;
      if (route.key === currentRouteKey && !options.force) return;

      const content = document.getElementById('page-content');
      content.classList.remove('loaded');

      fetch(route.file)
        .then((response) => response.text())
        .then((html) => {
          content.innerHTML = html;
          executeEmbeddedScripts(content);
          setTimeout(() => content.classList.add('loaded'), 50);
          window.scrollTo(0, 0);
          currentRouteKey = route.key;
          if (options.updateHistory !== false) {
            updateHistory(route, Boolean(options.replace));
          }
        });
    }

    function resolveInitialRoute() {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('v');
      if (token) {
        const routeFromToken = getRoute(token);
        if (routeFromToken) return routeFromToken;
      }

      const legacy = params.get('page');
      if (legacy) {
        const routeFromLegacy = getRoute(legacy);
        if (routeFromLegacy) return routeFromLegacy;
      }

      return getRoute(DEFAULT_ROUTE);
    }

    function navigateTo(routeKey) {
      renderRoute(routeKey);
      return false;
    }

    window.navigateTo = navigateTo;

    window.addEventListener('popstate', (event) => {
      const stateRoute = event.state && event.state.route;
      if (stateRoute) {
        renderRoute(stateRoute, { updateHistory: false, force: true });
      } else {
        const resolved = resolveInitialRoute();
        renderRoute(resolved ? resolved.key : DEFAULT_ROUTE, { updateHistory: false, replace: true, force: true });
      }
    });

    window.addEventListener('load', () => {
      const initial = resolveInitialRoute();
      renderRoute(initial ? initial.key : DEFAULT_ROUTE, { replace: true, force: true });
    });
  </script>
</body>
</html>
